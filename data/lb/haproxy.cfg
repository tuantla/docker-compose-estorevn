global
  log 127.0.0.1 local0
  log 127.0.0.1 local1 notice
  maxconn 4096
  tune.ssl.default-dh-param 2048

defaults
  log global
  mode http
  option httplog
  option dontlognull
  timeout connect 5000ms
  timeout client 50000ms
  timeout server 50000ms

listen stats
  bind 0.0.0.0:70
  mode http
  stats enable
  stats hide-version
  stats scope .
  stats realm Haproxy\ Statistics
  stats uri /
  #stats auth user:pass

frontend api.lab.java
  bind *:80
  #bind *:443 ssl crt /ssl/lab.java.pem
  mode http
  acl api_acl path_beg /api/ /u/ /oauth/ /oauth2/
  use_backend api_servers if api_acl !{ path_beg /api/internal }  
  default_backend default_backends

backend api_servers
  mode http
  option forwardfor
  balance roundrobin
  server api.prod.java api.prod.java:8084 check
  #option httpchk GET /api/internal/users/version
  #http-check expect status 200

backend default_backends
  mode http
  option forwardfor
  balance roundrobin
  server web.prod.java web.prod.java:5600 check
  http-request set-header X-Forwarded-Host %[req.hdr(Host)]
  http-request set-header X-Forwarded-Proto https
  #option httpchk GET /
  #http-check expect status 200
